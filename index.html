<!DOCTYPE html>
<html lang="th" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Prompt', sans-serif; }
    
    /* Animation Utility Classes */
    .stat-card {
      transition: all 0.3s ease;
      cursor: pointer;
    }
    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.1);
    }
    
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .fade-in { animation: fadeInUp 0.5s ease-out forwards; }
    
    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

    .login-input:focus { box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1); }
    .nav-item { transition: all 0.2s ease; }
    .nav-item.active {
      background: rgba(255, 255, 255, 0.15);
      border-left: 4px solid #fff;
    }
    .form-input { transition: all 0.2s ease; }
    .form-input:focus { 
        border-color: #6366f1;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1); 
    }
  </style>
</head>
<body class="h-full bg-slate-50 overflow-hidden text-slate-800">
  <div id="app" class="w-full h-full flex flex-col">
    
    <!-- ================= LOGIN PAGE ================= -->
    <div id="login-page" class="w-full h-full flex items-center justify-center px-4 bg-gradient-to-br from-indigo-600 via-purple-600 to-indigo-800">
      <div class="max-w-md w-full animate-[slideInLeft_0.5s_ease-out]">
        <!-- Logo -->
        <div class="text-center mb-8">
          <div class="inline-flex items-center justify-center w-20 h-20 bg-white/20 rounded-2xl backdrop-blur-xl mb-6 border border-white/30 shadow-xl">
            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
          </div>
          <h1 class="text-3xl font-bold text-white mb-1 drop-shadow-md">‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏π‡πÅ‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
          <p class="text-indigo-100 text-sm font-light">Student Behavior Management System</p>
        </div>

        <!-- Form -->
        <div class="bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl p-8 border border-white/50">
          <form onsubmit="handleLogin(event)">
            <div class="mb-5">
              <label class="block text-sm font-semibold text-slate-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label>
              <input type="text" id="username" value="admin" class="login-input w-full px-4 py-3 border border-slate-200 rounded-xl focus:outline-none transition-colors bg-slate-50 focus:bg-white" placeholder="Username">
            </div>
            <div class="mb-6">
              <label class="block text-sm font-semibold text-slate-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
              <input type="password" id="password" value="1234" class="login-input w-full px-4 py-3 border border-slate-200 rounded-xl focus:outline-none transition-colors bg-slate-50 focus:bg-white" placeholder="Password">
            </div>

            <div id="login-error" class="hidden mb-4 p-3 bg-rose-50 border border-rose-200 text-rose-600 text-sm rounded-lg flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
            </div>

            <button type="submit" class="w-full py-3.5 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-xl shadow-lg shadow-indigo-200 transition-all active:scale-95">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
          </form>
          
          <div class="mt-6 text-center">
            <p class="text-xs text-slate-400">Demo: admin / 1234 (‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≠‡∏á teacher1 / 1234)</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ================= DASHBOARD LAYOUT ================= -->
    <div id="dashboard-layout" class="hidden w-full h-full flex bg-slate-50">
      
      <!-- Sidebar -->
      <aside class="w-72 bg-slate-900 text-slate-300 flex flex-col shadow-2xl z-20">
        <!-- Sidebar Header -->
        <div class="p-6 border-b border-slate-800 flex items-center gap-3">
            <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold shadow-lg shadow-indigo-500/30">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
            </div>
            <div>
                <h2 class="text-white font-bold text-lg leading-tight">StudentCare</h2>
                <p class="text-xs text-slate-500">System v1.0</p>
            </div>
        </div>

        <!-- User Profile -->
        <div class="p-4 mx-4 mt-6 bg-slate-800/50 rounded-xl border border-slate-700 flex items-center gap-3">
             <div id="user-avatar" class="w-10 h-10 rounded-full bg-gradient-to-tr from-indigo-500 to-purple-500 flex items-center justify-center text-white font-bold text-sm">
                 AD
             </div>
             <div class="overflow-hidden">
                 <p id="display-name" class="text-white text-sm font-medium truncate">Admin Teacher</p>
                 <p id="display-role" class="text-xs text-slate-500 truncate">‡∏ù‡πà‡∏≤‡∏¢‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</p>
             </div>
        </div>

        <!-- Menu -->
        <nav class="flex-1 px-4 py-6 space-y-1 overflow-y-auto">
          <p class="px-4 text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2">‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</p>
          
          <button onclick="switchPage('dashboard')" id="nav-dashboard" class="nav-item active w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left text-sm font-medium hover:text-white hover:bg-slate-800/50">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
            ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° (Dashboard)
          </button>
          
          <button onclick="switchPage('record')" id="nav-record" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left text-sm font-medium hover:text-white hover:bg-slate-800/50">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ñ‡∏™‡πÉ‡∏´‡∏°‡πà
          </button>
          
          <button onclick="switchPage('cases')" id="nav-cases" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left text-sm font-medium hover:text-white hover:bg-slate-800/50">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
            ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥/‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏™
          </button>

          <!-- Admin Menu (Hidden by default) -->
          <div id="admin-menu-section" class="hidden pt-6">
              <p class="px-4 text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</p>
              <button onclick="switchPage('admin')" id="nav-admin" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left text-sm font-medium text-amber-400 hover:text-amber-300 hover:bg-slate-800/50">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>
                ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
              </button>
          </div>
        </nav>

        <!-- Logout -->
        <div class="p-4 border-t border-slate-800">
          <button onclick="handleLogout()" class="w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left text-sm font-medium text-rose-400 hover:bg-rose-950/30 hover:text-rose-300 transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
            ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
          </button>
        </div>
      </aside>

      <!-- Main Content Area -->
      <div class="flex-1 flex flex-col h-full overflow-hidden relative">
        <!-- Topbar -->
        <header class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-8 shadow-sm z-10">
          <h2 id="page-title" class="text-xl font-bold text-slate-800">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</h2>
          <div class="flex items-center gap-4">
              <div class="text-right hidden sm:block">
                  <p class="text-sm font-bold text-slate-700" id="current-date">-</p>
                  <p class="text-xs text-slate-500" id="current-time">00:00:00</p>
              </div>
          </div>
        </header>

        <!-- Scrollable Content -->
        <main class="flex-1 overflow-auto bg-slate-50 p-8">
            
            <!-- VIEW: DASHBOARD -->
            <div id="view-dashboard" class="space-y-6 animate-[fadeInUp_0.4s_ease-out]">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex items-center justify-between stat-card group">
                        <div>
                            <p class="text-sm font-medium text-slate-500 mb-1">‡πÄ‡∏Ñ‡∏™‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                            <h3 class="text-3xl font-bold text-slate-800 group-hover:text-indigo-600 transition-colors" id="stat-total">0</h3>
                        </div>
                        <div class="w-12 h-12 bg-indigo-50 rounded-xl flex items-center justify-center text-indigo-600 group-hover:bg-indigo-600 group-hover:text-white transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex items-center justify-between stat-card group">
                        <div>
                            <p class="text-sm font-medium text-slate-500 mb-1">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
                            <h3 class="text-3xl font-bold text-amber-500" id="stat-pending">0</h3>
                        </div>
                        <div class="w-12 h-12 bg-amber-50 rounded-xl flex items-center justify-center text-amber-500 group-hover:bg-amber-500 group-hover:text-white transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex items-center justify-between stat-card group">
                        <div>
                            <p class="text-sm font-medium text-slate-500 mb-1">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß</p>
                            <h3 class="text-3xl font-bold text-emerald-600" id="stat-resolved">0</h3>
                        </div>
                        <div class="w-12 h-12 bg-emerald-50 rounded-xl flex items-center justify-center text-emerald-600 group-hover:bg-emerald-600 group-hover:text-white transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                    </div>
                </div>

                <!-- Graphs Area -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <h3 class="font-bold text-slate-800 mb-4">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°</h3>
                        <div id="chart-behavior" class="space-y-4">
                            <!-- JS Generated Bars -->
                            <div class="text-center text-slate-400 py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <h3 class="font-bold text-slate-800 mb-4">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</h3>
                        <div id="chart-grade" class="space-y-4">
                            <!-- JS Generated Bars -->
                            <div class="text-center text-slate-400 py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: RECORD FORM -->
            <div id="view-record" class="hidden max-w-3xl mx-auto animate-[fadeInUp_0.4s_ease-out]">
                <div class="bg-white rounded-2xl shadow-lg border border-slate-100 overflow-hidden">
                    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 px-8 py-6">
                        <h2 class="text-xl font-bold text-white flex items-center gap-2">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                            ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°
                        </h2>
                        <p class="text-indigo-100 text-sm mt-1">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</p>
                    </div>
                    
                    <form id="record-form" onsubmit="handleRecordSubmit(event)" class="p-8 space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-semibold text-slate-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏´‡∏ï‡∏∏</label>
                                <input type="date" id="input-date" required class="form-input w-full px-4 py-2.5 border border-slate-200 rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-slate-700 mb-2">‡πÄ‡∏ß‡∏•‡∏≤ (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)</label>
                                <input type="time" id="input-time" class="form-input w-full px-4 py-2.5 border border-slate-200 rounded-lg">
                            </div>
                        </div>

                        <div class="p-4 bg-slate-50 rounded-xl border border-slate-100 space-y-4">
                            <h4 class="text-sm font-bold text-indigo-600 uppercase tracking-wide">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h4>
                            <div class="grid grid-cols-1 md:grid-cols-12 gap-4">
                                <div class="md:col-span-6">
                                    <label class="block text-sm font-medium text-slate-600 mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                                    <input type="text" id="input-name" placeholder="‡∏î.‡∏ä. ‡∏£‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡πÄ‡∏û‡∏µ‡∏¢‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤" required class="form-input w-full px-4 py-2.5 border border-slate-200 rounded-lg">
                                </div>
                                <div class="md:col-span-3">
                                    <label class="block text-sm font-medium text-slate-600 mb-1">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</label>
                                    <select id="input-grade" required class="form-input w-full px-4 py-2.5 border border-slate-200 rounded-lg bg-white">
                                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                                        <option value="‡∏°.1">‡∏°.1</option>
                                        <option value="‡∏°.2">‡∏°.2</option>
                                        <option value="‡∏°.3">‡∏°.3</option>
                                        <option value="‡∏°.4">‡∏°.4</option>
                                        <option value="‡∏°.5">‡∏°.5</option>
                                        <option value="‡∏°.6">‡∏°.6</option>
                                    </select>
                                </div>
                                <div class="md:col-span-3">
                                    <label class="block text-sm font-medium text-slate-600 mb-1">‡∏´‡πâ‡∏≠‡∏á</label>
                                    <input type="text" id="input-room" placeholder="1" required class="form-input w-full px-4 py-2.5 border border-slate-200 rounded-lg text-center">
                                </div>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°</label>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <label class="cursor-pointer">
                                    <input type="radio" name="behavior" value="fight" class="peer sr-only" required>
                                    <div class="p-3 text-center border border-slate-200 rounded-lg peer-checked:bg-rose-50 peer-checked:border-rose-500 peer-checked:text-rose-700 hover:bg-slate-50 transition-all">
                                        <div class="text-xl mb-1">‚öîÔ∏è</div>
                                        <div class="text-xs font-medium">‡∏ó‡∏∞‡πÄ‡∏•‡∏≤‡∏∞‡∏ß‡∏¥‡∏ß‡∏≤‡∏ó</div>
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="behavior" value="skip" class="peer sr-only">
                                    <div class="p-3 text-center border border-slate-200 rounded-lg peer-checked:bg-amber-50 peer-checked:border-amber-500 peer-checked:text-amber-700 hover:bg-slate-50 transition-all">
                                        <div class="text-xl mb-1">üèÉ</div>
                                        <div class="text-xs font-medium">‡∏´‡∏ô‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="behavior" value="vice" class="peer sr-only">
                                    <div class="p-3 text-center border border-slate-200 rounded-lg peer-checked:bg-slate-100 peer-checked:border-slate-500 peer-checked:text-slate-700 hover:bg-slate-50 transition-all">
                                        <div class="text-xl mb-1">üö¨</div>
                                        <div class="text-xs font-medium">‡∏≠‡∏ö‡∏≤‡∏¢‡∏°‡∏∏‡∏Ç</div>
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="behavior" value="relationship" class="peer sr-only">
                                    <div class="p-3 text-center border border-slate-200 rounded-lg peer-checked:bg-pink-50 peer-checked:border-pink-500 peer-checked:text-pink-700 hover:bg-slate-50 transition-all">
                                        <div class="text-xl mb-1">üíï</div>
                                        <div class="text-xs font-medium">‡∏ä‡∏π‡πâ‡∏™‡∏≤‡∏ß</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
                            <textarea id="input-detail" rows="4" class="form-input w-full px-4 py-3 border border-slate-200 rounded-lg resize-none" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á..."></textarea>
                        </div>

                        <div class="flex items-center gap-4 pt-4 border-t border-slate-100">
                            <button type="button" onclick="resetForm()" class="px-6 py-2.5 text-slate-600 bg-slate-100 hover:bg-slate-200 font-medium rounded-lg transition-colors">‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤</button>
                            <button type="submit" class="flex-1 px-6 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg shadow-lg shadow-indigo-200 transition-all active:scale-95">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- VIEW: CASES LIST -->
            <div id="view-cases" class="hidden animate-[fadeInUp_0.4s_ease-out]">
                <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                    <div class="p-6 border-b border-slate-100 flex flex-col md:flex-row md:items-center justify-between gap-4">
                        <h3 class="font-bold text-slate-800 text-lg">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</h3>
                        <div class="flex gap-2">
                            <select id="filter-status" onchange="renderTable()" class="text-sm border border-slate-200 rounded-lg px-3 py-2 bg-slate-50">
                                <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                                <option value="pending">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                                <option value="resolved">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß</option>
                            </select>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-slate-50 border-b border-slate-200 text-xs uppercase text-slate-500 font-semibold tracking-wider">
                                    <th class="px-6 py-4">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                    <th class="px-6 py-4">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                                    <th class="px-6 py-4">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</th>
                                    <th class="px-6 py-4">‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°</th>
                                    <th class="px-6 py-4">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    <th class="px-6 py-4 text-right">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody id="cases-tbody" class="text-sm divide-y divide-slate-100">
                                <!-- JS Generated Rows -->
                                <tr><td colspan="6" class="px-6 py-8 text-center text-slate-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- VIEW: ADMIN MONITOR (NEW) -->
            <div id="view-admin" class="hidden space-y-6 animate-[fadeInUp_0.4s_ease-out]">
                
                <!-- Active Users Panel -->
                <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                    <div class="p-6 border-b border-slate-100 flex items-center justify-between">
                        <h3 class="font-bold text-slate-800 text-lg flex items-center gap-2">
                            <span class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span>
                            ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå (Active Sessions)
                        </h3>
                    </div>
                    <div class="p-6">
                         <div id="active-sessions-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                             <!-- JS Generated -->
                         </div>
                    </div>
                </div>

                <!-- Login Logs Panel -->
                <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                    <div class="p-6 border-b border-slate-100">
                        <h3 class="font-bold text-slate-800 text-lg">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Login Logs)</h3>
                    </div>
                    <div class="overflow-x-auto max-h-[500px]">
                        <table class="w-full text-left border-collapse">
                            <thead class="bg-slate-50 sticky top-0">
                                <tr class="text-xs uppercase text-slate-500 font-semibold tracking-wider border-b border-slate-200">
                                    <th class="px-6 py-3">‡πÄ‡∏ß‡∏•‡∏≤</th>
                                    <th class="px-6 py-3">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</th>
                                    <th class="px-6 py-3">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</th>
                                    <th class="px-6 py-3">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>
                                </tr>
                            </thead>
                            <tbody id="logs-tbody" class="text-sm divide-y divide-slate-100">
                                <!-- JS Generated -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </main>
      </div>

    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="fixed bottom-6 right-6 transform translate-y-20 opacity-0 transition-all duration-300 z-50">
      <div class="bg-slate-800 text-white px-6 py-3 rounded-lg shadow-2xl flex items-center gap-3">
          <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
          <span id="toast-msg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</span>
      </div>
  </div>

  <script>
    // --- Mock Data & LocalStorage ---
    const DB_KEY = 'student_behavior_db';
    const LOGS_KEY = 'system_login_logs';
    const SESSIONS_KEY = 'active_sessions_mock';
    
    let casesData = JSON.parse(localStorage.getItem(DB_KEY)) || [];
    let systemLogs = JSON.parse(localStorage.getItem(LOGS_KEY)) || [];
    let activeSessions = JSON.parse(localStorage.getItem(SESSIONS_KEY)) || {};

    // --- State Management ---
    let currentUser = null;

    // --- Utils ---
    const showToast = (msg) => {
        const toast = document.getElementById('toast');
        document.getElementById('toast-msg').textContent = msg;
        toast.classList.remove('translate-y-20', 'opacity-0');
        setTimeout(() => toast.classList.add('translate-y-20', 'opacity-0'), 3000);
    }

    const formatDate = (dateStr) => {
        const d = new Date(dateStr);
        return d.toLocaleDateString('th-TH', { day: 'numeric', month: 'short', year: '2-digit' });
    }

    const formatDateTime = (dateStr) => {
        const d = new Date(dateStr);
        return d.toLocaleDateString('th-TH', { day: 'numeric', month: 'short' }) + ' ' + d.toLocaleTimeString('th-TH');
    }

    const behaviorLabels = {
        'fight': { label: '‡∏ó‡∏∞‡πÄ‡∏•‡∏≤‡∏∞‡∏ß‡∏¥‡∏ß‡∏≤‡∏ó', color: 'text-rose-600 bg-rose-50' },
        'skip': { label: '‡∏´‡∏ô‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', color: 'text-amber-600 bg-amber-50' },
        'vice': { label: '‡∏≠‡∏ö‡∏≤‡∏¢‡∏°‡∏∏‡∏Ç', color: 'text-slate-600 bg-slate-100' },
        'relationship': { label: '‡∏ä‡∏π‡πâ‡∏™‡∏≤‡∏ß', color: 'text-pink-600 bg-pink-50' }
    };

    // --- Clock ---
    setInterval(() => {
        const now = new Date();
        document.getElementById('current-time').textContent = now.toLocaleTimeString('th-TH');
        document.getElementById('current-date').textContent = now.toLocaleDateString('th-TH', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric'});
    }, 1000);

    // --- Logger ---
    function logAction(user, action) {
        const entry = {
            id: Date.now(),
            timestamp: new Date().toISOString(),
            user: user,
            action: action,
            device: navigator.platform
        };
        systemLogs.unshift(entry); // Add to top
        if(systemLogs.length > 100) systemLogs.pop(); // Keep last 100
        localStorage.setItem(LOGS_KEY, JSON.stringify(systemLogs));
    }

    function updateSession(user, isActive) {
        if(isActive) {
            activeSessions[user] = new Date().toISOString();
        } else {
            delete activeSessions[user];
        }
        localStorage.setItem(SESSIONS_KEY, JSON.stringify(activeSessions));
    }

    // --- Login Logic ---
    function handleLogin(e) {
        e.preventDefault();
        const user = document.getElementById('username').value;
        const pass = document.getElementById('password').value;

        // Allow any user with password '1234' for simulation
        if(pass === '1234' && user.trim() !== '') {
            currentUser = user;
            
            // Log & Session
            logAction(user, '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö (Login)');
            updateSession(user, true);

            // UI Updates
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('dashboard-layout').classList.remove('hidden');
            document.getElementById('display-name').textContent = user === 'admin' ? 'Admin Teacher' : user;
            document.getElementById('display-role').textContent = user === 'admin' ? '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î' : '‡∏Ñ‡∏£‡∏π‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤';
            document.getElementById('user-avatar').textContent = user.substring(0,2).toUpperCase();

            // Admin Menu Toggle
            if(user === 'admin') {
                document.getElementById('admin-menu-section').classList.remove('hidden');
            } else {
                document.getElementById('admin-menu-section').classList.add('hidden');
            }

            initDashboard();
        } else {
            document.getElementById('login-error').classList.remove('hidden');
        }
    }

    function handleLogout() {
        if(confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?')) {
            if(currentUser) {
                logAction(currentUser, '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö (Logout)');
                updateSession(currentUser, false);
            }
            
            // Reset User State
            currentUser = null;

            // Switch Views
            document.getElementById('dashboard-layout').classList.add('hidden');
            document.getElementById('login-page').classList.remove('hidden');

            // Clear Login Form
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('login-error').classList.add('hidden');
        }
    }

    // --- Navigation ---
    function switchPage(pageId) {
        // Hide all views
        ['view-dashboard', 'view-record', 'view-cases', 'view-admin'].forEach(id => {
            const el = document.getElementById(id);
            if(el) el.classList.add('hidden');
        });
        
        // Reset nav styles
        ['nav-dashboard', 'nav-record', 'nav-cases', 'nav-admin'].forEach(id => {
            const el = document.getElementById(id);
            if(el) {
                el.classList.remove('active', 'bg-white/10', 'border-l-4');
                el.classList.add('hover:bg-slate-800/50');
            }
        });

        // Show selected view
        document.getElementById(`view-${pageId}`).classList.remove('hidden');
        
        // Activate nav
        const activeNav = document.getElementById(`nav-${pageId}`);
        if(activeNav) {
            activeNav.classList.add('active');
            activeNav.classList.remove('hover:bg-slate-800/50');
        }

        // Update Title
        const titles = {
            'dashboard': '‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•',
            'record': '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà',
            'cases': '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥',
            'admin': '‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö (Admin Monitor)'
        };
        document.getElementById('page-title').textContent = titles[pageId];

        if(pageId === 'dashboard') updateStats();
        if(pageId === 'cases') renderTable();
        if(pageId === 'admin') renderAdminPanel();
    }

    // --- Admin Panel Logic ---
    function renderAdminPanel() {
        // 1. Render Active Sessions
        const sessionContainer = document.getElementById('active-sessions-list');
        const users = Object.keys(activeSessions);
        
        if(users.length === 0) {
            sessionContainer.innerHTML = '<div class="col-span-4 text-center text-slate-400 py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</div>';
        } else {
            sessionContainer.innerHTML = users.map(u => `
                <div class="flex items-center gap-3 p-4 bg-slate-50 border border-slate-200 rounded-xl">
                    <div class="w-10 h-10 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center font-bold">
                        ${u.substring(0,2).toUpperCase()}
                    </div>
                    <div>
                        <p class="font-bold text-slate-700">${u}</p>
                        <p class="text-xs text-emerald-600 flex items-center gap-1">
                            <span class="w-1.5 h-1.5 bg-emerald-500 rounded-full"></span> ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
                        </p>
                    </div>
                </div>
            `).join('');
        }

        // 2. Render Logs
        const logTbody = document.getElementById('logs-tbody');
        logTbody.innerHTML = systemLogs.map(log => {
            const isLogin = log.action.includes('Login');
            return `
                <tr class="border-b border-slate-100 hover:bg-slate-50">
                    <td class="px-6 py-3 text-slate-500 font-mono text-xs">${formatDateTime(log.timestamp)}</td>
                    <td class="px-6 py-3 font-medium text-slate-700">${log.user}</td>
                    <td class="px-6 py-3">
                        <span class="px-2 py-1 rounded text-xs font-bold ${isLogin ? 'bg-indigo-100 text-indigo-700' : 'bg-slate-100 text-slate-600'}">
                            ${log.action}
                        </span>
                    </td>
                    <td class="px-6 py-3 text-slate-400 text-xs">${log.device}</td>
                </tr>
            `;
        }).join('');
    }

    // --- Form Handling ---
    function handleRecordSubmit(e) {
        e.preventDefault();
        
        // Get Radio Value
        const behaviors = document.getElementsByName('behavior');
        let selectedBehavior = '';
        for(let b of behaviors) if(b.checked) selectedBehavior = b.value;

        const newCase = {
            id: Date.now(),
            date: document.getElementById('input-date').value,
            time: document.getElementById('input-time').value,
            name: document.getElementById('input-name').value,
            grade: document.getElementById('input-grade').value,
            room: document.getElementById('input-room').value,
            behavior: selectedBehavior,
            detail: document.getElementById('input-detail').value,
            status: 'pending', // pending, resolved
            timestamp: new Date().toISOString()
        };

        casesData.unshift(newCase); // Add to top
        localStorage.setItem(DB_KEY, JSON.stringify(casesData));
        
        showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        resetForm();
    }

    function resetForm() {
        document.getElementById('record-form').reset();
        document.getElementById('input-date').valueAsDate = new Date();
    }

    // --- Dashboard Stats & Charts ---
    function updateStats() {
        // Counts
        const total = casesData.length;
        const pending = casesData.filter(c => c.status === 'pending').length;
        const resolved = casesData.filter(c => c.status === 'resolved').length;

        document.getElementById('stat-total').innerText = total;
        document.getElementById('stat-pending').innerText = pending;
        document.getElementById('stat-resolved').innerText = resolved;

        // Simple Bar Charts Rendering
        renderSimpleChart('chart-behavior', getGroupedData('behavior'), behaviorLabels);
        renderSimpleChart('chart-grade', getGroupedData('grade'));
    }

    function getGroupedData(key) {
        const counts = {};
        casesData.forEach(c => {
            const val = c[key];
            counts[val] = (counts[val] || 0) + 1;
        });
        return counts;
    }

    function renderSimpleChart(containerId, data, labelsMap = null) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        
        const total = Object.values(data).reduce((a,b)=>a+b, 0);
        if(total === 0) {
            container.innerHTML = '<div class="text-center text-slate-400 py-4 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';
            return;
        }

        Object.entries(data).forEach(([key, value]) => {
            const percentage = (value / total) * 100;
            let label = key;
            let colorClass = 'bg-indigo-500';

            if(labelsMap && labelsMap[key]) {
                label = labelsMap[key].label;
                // Extract color just for variety (simple logic)
                if(key === 'fight') colorClass = 'bg-rose-500';
                if(key === 'skip') colorClass = 'bg-amber-500';
                if(key === 'relationship') colorClass = 'bg-pink-500';
                if(key === 'vice') colorClass = 'bg-slate-500';
            } else {
                // Randomish colors for grades
                if(key.includes('1')) colorClass = 'bg-blue-400';
                if(key.includes('2')) colorClass = 'bg-blue-500';
                if(key.includes('3')) colorClass = 'bg-blue-600';
                if(key.includes('4')) colorClass = 'bg-purple-400';
                if(key.includes('5')) colorClass = 'bg-purple-500';
                if(key.includes('6')) colorClass = 'bg-purple-600';
            }

            container.innerHTML += `
                <div class="flex items-center gap-3 text-sm">
                    <div class="w-20 font-medium text-slate-600 truncate">${label}</div>
                    <div class="flex-1 h-2.5 bg-slate-100 rounded-full overflow-hidden">
                        <div class="h-full ${colorClass} rounded-full" style="width: ${percentage}%"></div>
                    </div>
                    <div class="w-8 text-right text-slate-500">${value}</div>
                </div>
            `;
        });
    }

    // --- Table Rendering ---
    function renderTable() {
        const tbody = document.getElementById('cases-tbody');
        const filter = document.getElementById('filter-status').value;
        
        let filteredData = casesData;
        if(filter !== 'all') {
            filteredData = casesData.filter(c => c.status === filter);
        }

        if(filteredData.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-8 text-center text-slate-400">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
            return;
        }

        tbody.innerHTML = filteredData.map(c => {
            const bInfo = behaviorLabels[c.behavior] || { label: c.behavior, color: 'text-gray-600 bg-gray-100' };
            const statusBadge = c.status === 'resolved' 
                ? '<span class="px-2.5 py-1 rounded-full text-xs font-bold bg-emerald-100 text-emerald-700">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß</span>'
                : '<span class="px-2.5 py-1 rounded-full text-xs font-bold bg-amber-100 text-amber-700">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</span>';

            return `
                <tr class="hover:bg-slate-50 transition-colors border-b border-slate-100 last:border-0">
                    <td class="px-6 py-4 whitespace-nowrap text-slate-500">${formatDate(c.date)}</td>
                    <td class="px-6 py-4 font-medium text-slate-800">${c.name}</td>
                    <td class="px-6 py-4 text-slate-600">${c.grade}/${c.room}</td>
                    <td class="px-6 py-4">
                        <span class="px-2.5 py-1 rounded-md text-xs font-bold ${bInfo.color}">${bInfo.label}</span>
                    </td>
                    <td class="px-6 py-4">${statusBadge}</td>
                    <td class="px-6 py-4 text-right">
                        <button onclick="toggleStatus(${c.id})" class="text-xs font-medium text-indigo-600 hover:text-indigo-800 underline">
                            ${c.status === 'resolved' ? '‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏£‡∏≠' : '‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à'}
                        </button>
                        <button onclick="deleteCase(${c.id})" class="ml-3 text-xs font-medium text-rose-500 hover:text-rose-700">‡∏•‡∏ö</button>
                    </td>
                </tr>
            `;
        }).join('');
    }

    // --- Actions ---
    function toggleStatus(id) {
        const index = casesData.findIndex(c => c.id === id);
        if(index !== -1) {
            casesData[index].status = casesData[index].status === 'resolved' ? 'pending' : 'resolved';
            localStorage.setItem(DB_KEY, JSON.stringify(casesData));
            renderTable();
            showToast('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        }
    }

    function deleteCase(id) {
        if(confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
            casesData = casesData.filter(c => c.id !== id);
            localStorage.setItem(DB_KEY, JSON.stringify(casesData));
            renderTable();
            showToast('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        }
    }

    function initDashboard() {
        document.getElementById('input-date').valueAsDate = new Date();
        updateStats();
    }
  </script>
</body>
</html>
